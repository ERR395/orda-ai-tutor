<!DOCTYPE html>
<html lang="kk">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ORDA AI Academy</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        :root { --orda-green: #004d33; --orda-gold: #c5a059; }
        .bg-orda { background-color: var(--orda-green); }
        .text-orda-gold { color: var(--orda-gold); }
        #main-app { display: none; } /* Басында жасырын тұрады */
        ::-webkit-scrollbar { width: 6px; }
        ::-webkit-scrollbar-thumb { background: var(--orda-gold); border-radius: 10px; }
        pre { white-space: pre-wrap; word-wrap: break-word; }
    </style>
</head>
<body class="bg-slate-900 h-screen flex flex-col font-sans overflow-hidden text-slate-900">

    <div id="login-modal" class="fixed inset-0 bg-slate-900 flex items-center justify-center z-[100]">
        <div class="bg-white p-8 rounded-2xl border-4 border-orda-gold w-96 text-center shadow-2xl">
            <div class="mb-6 flex justify-center">
                <div class="w-24 h-24 bg-white rounded-xl flex items-center justify-center border-2 border-orda-gold p-1 shadow-lg overflow-hidden">
                    <img src="https://raw.githubusercontent.com/ERR395/orda-ai-tutor/main/orda_logo.png" 
                         alt="ORDA" class="max-w-full max-h-full object-contain"
                         onerror="this.src='https://via.placeholder.com/150?text=ORDA'">
                </div>
            </div>
            <h2 class="text-2xl font-bold mb-6 text-orda">Қош келдіңіз!</h2>
            <div class="space-y-4">
                <input type="text" id="user-name" class="w-full border-2 border-gray-200 rounded-xl p-3 outline-none focus:border-orda text-center font-semibold" placeholder="Есіміңізді жазыңыз">
                <select id="subject-select" class="w-full border-2 border-gray-200 rounded-xl p-3 outline-none focus:border-orda font-medium bg-gray-50">
                    <option value="Python">Python Бағдарламалау</option>
                    <option value="HTML/CSS">HTML/CSS Веб-дизайн</option>
                    <option value="C++">C++ Тілі</option>
                    <option value="JavaScript">JavaScript Негіздері</option>
                </select>
                <button onclick="startApp()" class="w-full bg-orda text-white py-4 rounded-xl font-bold text-lg hover:bg-emerald-900 transition-all shadow-lg active:scale-95">
                    Оқуды бастау
                </button>
            </div>
        </div>
    </div>

    <div id="main-app" class="h-full flex flex-col bg-gray-100">
        <header class="bg-orda text-white p-3 flex justify-between items-center border-b-4 border-orda-gold">
            <div class="flex items-center gap-3">
                <img src="https://raw.githubusercontent.com/ERR395/orda-ai-tutor/main/orda_logo.png" class="h-8 w-8 object-contain bg-white rounded-sm p-0.5" onerror="this.style.display='none'">
                <h1 class="text-lg font-bold tracking-tight text-white uppercase">ORDA <span class="text-orda-gold" id="current-subject-title">AI</span></h1>
            </div>
            <div class="text-xs font-bold bg-black/20 px-3 py-1 rounded-full border border-white/20" id="welcome-text">...</div>
        </header>

        <div class="flex-1 flex overflow-hidden">
            <div class="w-1/3 flex flex-col bg-white border-r border-gray-300 shadow-inner">
                <div id="chat-box" class="flex-1 overflow-y-auto p-4 space-y-4 bg-gray-50 text-sm"></div>
                <div class="p-3 border-t border-gray-200 bg-white flex gap-2">
                    <input type="text" id="user-input" class="flex-1 border-2 border-gray-200 rounded-xl px-4 py-2 text-sm outline-none focus:border-orda" placeholder="Сұрақ қойыңыз...">
                    <button onclick="sendMessage()" class="bg-orda text-white px-6 py-2 rounded-xl font-bold hover:opacity-90">Жіберу</button>
                </div>
            </div>

            <div class="flex-1 flex flex-col bg-slate-800">
                <div class="p-2 bg-slate-900 text-[10px] flex justify-between items-center px-4">
                    <span class="text-orda-gold font-bold tracking-widest uppercase italic" id="editor-label">EDITOR</span>
                    <button onclick="runCode()" class="bg-green-600 hover:bg-green-500 text-white px-4 py-1 rounded text-[10px] font-black transition uppercase animate-pulse">RUN / CHECK CODE</button>
                </div>
                <div class="flex-1 p-2">
                    <textarea id="code-area" class="w-full h-full bg-slate-900 text-emerald-400 font-mono p-4 rounded-lg border border-slate-700 outline-none resize-none" placeholder="Кодты осында жазыңыз..."></textarea>
                </div>
                <div class="h-1/3 bg-black p-4 font-mono text-xs text-green-500 overflow-y-auto border-t-2 border-orda-gold shadow-2xl">
                    <div class="text-slate-500 text-[10px] mb-2 font-bold uppercase tracking-tighter">Terminal Output:</div>
                    <pre id="output">>>> Жүйе дайын...</pre>
                </div>
            </div>
        </div>
    </div>

    <script>
        let userName = "";
        let currentSubject = "";

        // Бағдарламаны іске қосу
        function startApp() {
            userName = document.getElementById('user-name').value.trim();
            currentSubject = document.getElementById('subject-select').value;
            
            if(!userName) { alert("Есіміңізді жазыңыз!"); return; }

            // Логинді жасырып, негізгі бетті ашамыз
            document.getElementById('login-modal').style.display = 'none';
            document.getElementById('main-app').style.display = 'flex';
            
            document.getElementById('welcome-text').innerText = "Оқушы: " + userName;
            document.getElementById('current-subject-title').innerText = "| " + currentSubject;
            document.getElementById('editor-label').innerText = currentSubject + " Editor";

            appendMessage('Мұғалім', `Сәлем, <b>${userName}</b>! Мен AI мұғаліммін. Сабақты бастайық!`, 'bg-white border-l-8 border-orda-gold text-slate-800 shadow-sm');
        }

        // Чатқа хабарлама жазу
        async function sendMessage() {
            const input = document.getElementById('user-input');
            const codeInput = document.getElementById('code-area');
            const text = input.value.trim();
            const currentCode = codeInput.value;

            if (!text) return;

            appendMessage('Сіз', text, 'bg-emerald-100 border border-emerald-200 text-emerald-900 ml-6');
            input.value = '';

            try {
                const response = await fetch('https://orda-ai-tutor.onrender.com/chat', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({ 
                        username: userName, 
                        message: text, 
                        subject: currentSubject,
                        current_code: currentCode 
                    })
                });
                const data = await response.json();
                appendMessage('Мұғалім', data.reply, 'bg-white border-l-8 border-orda-gold text-slate-800 shadow-md');
            } catch (err) {
                appendMessage('Қате', 'Сервермен байланыс жоқ (Render ұйықтап жатқан шығар).', 'bg-red-100 text-red-800');
            }
        }

        // Хабарламаны экранға шығару көмекшісі
        function appendMessage(sender, text, style) {
            const chatBox = document.getElementById('chat-box');
            const div = document.createElement('div');
            div.className = `${style} p-4 rounded-xl transition-all duration-300`;
            div.innerHTML = `<span class="text-[9px] uppercase font-black block mb-1 opacity-40">${sender}</span> ${text}`;
            chatBox.appendChild(div);
            chatBox.scrollTop = chatBox.scrollHeight;
        }

        // --- КОДТЫ ТЕКСЕРУ (Сенің сұраған логикаң) ---
        async function runCode() {
            const code = document.getElementById('code-area').value;
            const output = document.getElementById('output');
            
            if (!code.trim()) { 
                output.innerText = ">>> Код жазылмаған!"; 
                return; 
            }
            
            output.innerText = ">>> Орындалуда..."; 
            output.className = "text-yellow-400"; // Сары түс (күту)

            try {
                // Серверге "ТЕКСЕРУ_РЕЖИМІ" кодын жібереміз
                const response = await fetch('https://orda-ai-tutor.onrender.com/chat', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({ 
                        username: userName, 
                        message: "ТЕКСЕРУ_РЕЖИМІ", 
                        subject: currentSubject,
                        current_code: code 
                    })
                });
                const data = await response.json();
                
                // Жауапты тексереміз: Ішінде '|||' бар ма?
                if (data.reply && data.reply.includes("|||")) {
                    // --- ЕГЕР ҚАТЕ БОЛСА ---
                    const parts = data.reply.split("|||");
                    const terminalError = parts[0].trim(); // Ағылшынша қате
                    const chatExplanation = parts[1].trim(); // Қазақша түсіндірме
                    
                    // Терминалға қызылмен қатені жазамыз
                    output.innerText = ">>> ERROR:\n" + terminalError;
                    output.className = "text-red-500 font-bold";
                    
                    // Чатқа түсіндірмесін жібереміз
                    appendMessage('Мұғалім', `<b>Кодта қате бар:</b><br>${chatExplanation}`, 'bg-red-50 border-l-8 border-red-500 text-slate-800 shadow-md');
                } else {
                    // --- ЕГЕР ДҰРЫС БОЛСА ---
                    // Тек терминалға шығарамыз. Чатқа ештеңе жазбаймыз.
                    output.innerText = ">>> НӘТИЖЕ:\n" + data.reply;
                    output.className = "text-green-400"; // Жасыл түс
                }

            } catch (err) {
                output.innerText = ">>> Сервер қатесі (429 Quota). 1 минут күтіңіз."; 
                output.className = "text-red-500";
            }
        }
        
        // Enter басқанда хабарлама жіберу
        document.getElementById('user-input').addEventListener('keypress', (e) => { if(e.key === 'Enter') sendMessage(); });
    </script>
</body>
</html>
